function create_chart(chart_id, labels, values, colors, title) {
    // Retrieve the data passed from Flask
    //  var labels = ['Red', 'Blue', 'Yellow'];
    //  var values = [10, 20, 30];
     console.log(labels);
     console.log(values);
     console.log(colors);
     console.log(title)
     // Create the chart
     var ctx = document.getElementById(chart_id).getContext('2d');
     var myChart = new Chart(ctx, {
         type: 'pie',
         data: {
             labels: labels,
             datasets: [{
                 data: values,
                 backgroundColor: colors,
                 // backgroundColor: ['red', 'blue', 'yellow'],
             }]
         },
         options: {
            title: {
              display: true,
              text: title
            }
          }
     })
};

function load_tabel_categories(){
    fetch(server_location +'malware/2')
         .then(response => response.text())
         .then(data => {
             console.log(data)
             console.log(JSON.parse(data))
             let table_cat= document.getElementById('table_categories');
             for( el of JSON.parse(data)){
                 let tr_cat = document.createElement("tr");
                 tr_cat.className="table-row";
                 let td_id = document.createElement("td");
                 td_id.className = "table-data";
                 td_id.innerHTML = el.id;
                 let td_name = document.createElement("td");
                 td_name.className = "table-data";
                 td_name.innerHTML = el.name;
                 let td_score = document.createElement("td");
                 td_score.className = "table-data";
                 td_score.innerHTML = el.score;
                 tr_cat.appendChild(td_id)
                 tr_cat.appendChild(td_name)
                 tr_cat.appendChild(td_score);
                 table_cat.appendChild(tr_cat);
             }
        }).catch(err => {
            alert("Cannot retrieve categories! Error :" + err);
     })
}

function load_tabel_platforms(){
    fetch(server_location +'malware/1')
         .then(response => response.text())
         .then(data => {
             console.log(data)
             console.log(JSON.parse(data))
             let table_plat= document.getElementById('table_platforms');
             for( el of JSON.parse(data)){
                 let tr_plat = document.createElement("tr");
                 tr_plat.className="table-row";
                 let td_id = document.createElement("td");
                 td_id.className = "table-data";
                 td_id.innerHTML = el.id;
                 let td_name = document.createElement("td");
                 td_name.className = "table-data";
                 td_name.innerHTML = el.name;
                 let td_score = document.createElement("td");
                 td_score.className = "table-data";
                 td_score.innerHTML = el.score;
                 tr_plat.appendChild(td_id)
                 tr_plat.appendChild(td_name)
                 tr_plat.appendChild(td_score);
                 table_plat.appendChild(tr_plat);
             }
        }).catch(err => {
            alert("Cannot retrieve categories! Error :" + err);
     })
}

function load_chart_sample_platform_stats(){
    fetch(server_location +'malware/3')
         .then(response => response.text())
         .then(data => {
             console.log(data)
             console.log(JSON.parse(data))
             let labels =[]
             let values =[]
             let colors = ['red', 'yellow', 'green', 'blue', 'purple', 'magenta', 'brown','rgba(0,0,255,1.0)','rgba(0,0,255,0.8)', 'rgba(0,0,255,0.4)'];
             let title = "Top 10 samples over platforms"
             let list_stats = JSON.parse(data)
             list_stats.sort(function(a, b){return b.value-a.value});
             let poz = 0;
             for( el of list_stats){
                 labels.push(el.name);
                 values.push(el.value);
                 poz++;
                 if (poz >= 10){
                     break;
                 }
             }
             create_chart("canvas_sample_plat",labels,values,colors,title);
        }).catch(err => {
            alert("Cannot retrieve categories! Error :" + err);
            // document.getElementById('content').textContent = err;
     })
}

function load_chart_sample_categories_stats(){
    fetch(server_location +'malware/4')
         .then(response => response.text())
         .then(data => {
             console.log(data)
             console.log(JSON.parse(data))
             let labels =[]
             let values =[]
             let colors = ['red', 'yellow', 'green', 'blue', 'purple', 'magenta', 'brown','rgba(0,0,255,1.0)','rgba(0,0,255,0.8)', 'rgba(0,0,255,0.4)'];
             let title = "Top 10 samples over categories"
             let list_stats = JSON.parse(data)
             list_stats.sort(function(a, b){return b.value-a.value});
             let poz = 0;
             for( el of list_stats){
                 labels.push(el.name);
                 values.push(el.value);
                 poz++;
                 if (poz >= 10){
                     break;
                 }
             }
             create_chart("canvas_sample_cat",labels,values,colors,title);
        }).catch(err => {
            alert("Cannot retrieve categories! Error :" + err);
            // document.getElementById('content').textContent = err;
     })
}


function load_data(){
    load_tabel_platforms();
    load_tabel_categories();
    load_chart_sample_platform_stats();
    load_chart_sample_categories_stats();
}

document.addEventListener('DOMContentLoaded', function() {
    console.log("s-a infaptuit evenimentul");
});
load_data()
//create_chart();
